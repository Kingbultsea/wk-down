<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>
<script src="js/html2canvas.min.js"></script>
  <img id="mooncake1" src="images/bg1.png"/>
  <img id="mooncake2" src="images/bg2.png"/>
  <img id="mooncake3" src="images/bg3.png"/>
  <img id="mooncake4" src="images/bg4.png"/>
  <img id="mooncake5" src="images/bg5.png"/>
  <img id="mooncake6" src="images/bg6.png"/>
  <img id="mooncake7" src="images/bg7.png"/>
  <img id="mooncake8" src="images/bg8.png"/>
  <img id="mooncake9" src="images/bg9.png"/>
  <img id="mooncake10" src="images/bg10.png"/>
  <img id="mooncake11" src="images/bg11.png"/>
  <img id="mooncake12" src="images/bg12.png"/>

  <!--<img id="mooncakeq" src="images/mooncake_bg.svg"/>-->
  <div class="main">

      <div id="addCanvas" class="center-content">
          <div class="top">
              <img src="images/f-day_img_openning_logo1.svg" />
          </div>
          <img class="title-img" src="images/title.svg">
          <img class="content-img" id="canvas-remove" src="images/m_start_img.svg"><!--需要加opacity的-->
          <!-- 将把上面的图片所占的地方给隐藏起来 -->
              <canvas class="io" id="myCanvas" width="740" height="740" ></canvas>

          <div class="fill-color-origion"><!--需要加opacity的-->
              <a id="btn-begin"  class="btn-a">
                  <div class="btn">
                  <img src="images/m_btn.svg">
                  <p>马上开始</p>
                  </div>
              </a>
              <div class="download" >
                  <a href="https://www.heartide.com/statics/redirect?url=345"><img id="download" src="images/start_tocosleep_btn2.gif" /></a>
              </div>
          </div>
      </div>

  </div>
  <div class="score-frame">
      <div  class="score-tainer">
          <div class="score-border" id="saveImg">
              <img src="images/finally_title.svg" />
              <div id="load_svg" class="container"  ontouchstart="gtouchstart()" ontouchmove="gtouchmove()" ontouchend="gtouchend()">
                  <!--<button id="download_svg">test</button><!--下载按钮哦-->
                  <div class="container-score-frame">
                      <ul>
                          <li>姓名：<span id="name"></span></li>
                          <li id="degreed">等级：</li>
                          <li id="style">风格:</li>
                      </ul>
                      <div>
                          <div class="one">成绩:</div>
                          <div class="two">
                              <div>
                                  <img id="scoreOne" src=""/>
                                  <img id="scoreTwo" src=""/>
                              </div>
                              <div>
                                  <img src="images/line.svg"/>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div id="information" class="infomation">

                  </div>
              </div>
              <div class="bottom">
                  <img src="images/f-day_img_openning_logo@2x.png" style="position: relative;bottom: -0.8em;" />
                  <img src="images/QRcode.png" style="float:right;height: 2.5em;width: 2.5em;padding-right: 0.3em">
              </div>
          </div>
      </div>
      <p class="small-tips">*长按上方保存图片*</p>
      <div class="score-bottom">
          <div id="toDownloadPage" class="btn">
              <img src="images/m_btn.png"/>
              <p>阖家团圆</p>
          </div>
          <div class="btn" id="download_svg">
              <img src="images/m_btn.svg" />
              <p>再玩一次</p>
          </div>

      </div>
  </div>
  <div class="result-download">
      <img  src="images/result_download.svg"/>
      <div class="background" >
          <p>月下酣眠，暖声陪伴。</p> <p>梦醒时分，记录睡眠。</p> <p>小睡眠App让你拥有好睡眠！</p>
          <a href="https://a.app.qq.com/o/simple.jsp?pkgname=com.psyone.brainmusic">
          <div class="btn">
              <img src="images/m_btn.png"/>
              <p>点击下载</p>
          </div>
          </a>
      </div>

  </div>
<!-- <p id="test">sdjaskdja</p> -->
  <script src="js/paper-full.js" type="text/javascript" ></script>
  <script defer>
      //function onload(){
          //if(document.getElementById('canvas-remove').height == 0){
          //    location.reload()
          //}

          //var canvasSize = document.getElementById('myCanvas')
          //canvasSize.width = document.getElementById('canvas-remove').height
          //canvasSize.height = document.getElementById('canvas-remove').height

          //console.log(canvasSize.width + canvasSize.height)
          //console.log('执行调整canvas')
      //}
      //setTimeout(onload,0)

  </script>
  <script src="js/main.js" type="text/paperscript" canvas="myCanvas"></script>
  <script>
      function beginTheGame(){
          this.classList.add('opacity')
          document.getElementsByClassName('fill-color-origion')[0].classList.add('opacity')
          document.getElementsByClassName('content-img')[0].classList.add('opacity')
          this.classList.remove('btn-a')
          this.removeEventListener('click',beginTheGame)
          setTimeout(addCanvas, 700)
      }

      function addCanvas(){
          document.getElementById('myCanvas').style.display = 'block'
          document.getElementById("addCanvas").removeChild(document.getElementById('canvas-remove'))
      }



      document.getElementById('btn-begin').addEventListener('click',beginTheGame.bind(document.getElementById('btn-begin')))

      let getAllName
      document.getElementById('download_svg').addEventListener('click',()=>{
          //location.reload()
          //修复安卓刷新不了
          //window.location.href = window.location.href+"?pfid=1&" + Date.parse(new Date());
          //getAllName = document.getElementById('name').innerHTML
          alert(getAllName)
          if(!window.location.href.match(/name/)) {  window.location.href + '&name=' + getAllName }else{
              window.location.href = window.location.href+"&pfid=1&" + Date.parse(new Date());
          }



      })

      document.getElementById('toDownloadPage').addEventListener('click',()=>{
          document.getElementsByClassName("result-download")[0].style.display = 'flex'
      })

      /*document.getElementById('test').addEventListener('click', ()=>{
          //显示成image
          document.getElementById('load_svg').appendChild(paper.project.exportSVG())
          //转换 img
          html2canvas(document.getElementById("load_svg")).then(function(canvas){
              document.body.appendChild(canvas);
          })
      })*/

  </script>
<script>
    var timeOutEvent= 0//定时器
    //开始按
    function gtouchstart(){




        timeOutEvent = setTimeout("longPress()",500);//这里设置定时器，定义长按500毫秒触发长按事件，时间可以自己改，个人感觉500毫秒非常合适
        return false;
    }
    //手释放，如果在500毫秒内就释放，则取消长按事件，此时可以执行onclick应该执行的事件
    function gtouchend(){
        clearTimeout(timeOutEvent);//清除定时器
        if(timeOutEvent!=0){
            //这里写要执行的内容（尤如onclick事件）

           // alert("你这是点击，不是长按");
        }
        return false;
    }
    //如果手指有移动，则取消所有事件，此时说明用户只是要移动而不是长按
    function gtouchmove(){
        clearTimeout(timeOutEvent);//清除定时器
        timeOutEvent = 0;

    }

    //真正长按后应该执行的内容
    function longPress(){
        timeOutEvent = 0;

        //转换 img


        //alert("长按事件触发发");
    }

    setTimeout(()=>{
       // document.getElementById('mooncake').src = 'images/bg'+ ['1', '2', '3'][randomNum(0,2)]
    },0)

    function randomNum(minNum,maxNum){
        switch(arguments.length){
            case 1:
                return parseInt(Math.random()*minNum+1,10);
                break;
            case 2:
                return parseInt(Math.random()*(maxNum-minNum+1)+minNum,10);
                break;
            default:
                return 0;
                break;
        }
    }
    //js sdk 配置
    let sdkurl =  window.location.href.split('#')[0]
    //alert('js sdk url '+'https://api.debug.psy-1.com' + '/web/v1/wechat/config?url=' + sdkurl)
    //window.location.href = 'https://api.debug.psy-1.com' + '/get/web/v1/wechat/config?url=' + sdkurl
    //alert(code)

    var appid = 'wx632d4c99bd681cf3' //全局

    var QRblock = /code=(.+?)&/
    var code
    var QRblockResult = window.location.href.match(QRblock)

    if( window.location.href.match(QRblock) )code= window.location.href.match(QRblock)[1]

    if( !window.location.href.match(QRblock) ){
    //code = window.location.href.match(QRblock)[1]

    let getappid = new XMLHttpRequest();
    getappid.open('GET', 'https://api.debug.psy-1.com' + '/web/v1/wechat/config?url=' + sdkurl)
    getappid.onreadystatechange = function(){
        if(getappid.readyState === 4){

            if(getappid.status === 200){
                alert('js sdk配置成功')
                //appid =JSON.parse( getappid.response ).data.appId
            }
        }
        //alert()
    }
    getappid.onerror = function(msg){
        alert('错误了 js sdk')
        //alert(getName.readyState+' '+getName.status)
    }
    getappid.send()

    //微信接口获取code
    alert(window.location.href + '当前url')
    alert('redirect_uri为'+ encodeURI( window.location.href ) +'已进行urIencode')
    window.location.href = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx632d4c99bd681cf3&redirect_uri=' + encodeURI( window.location.href ) +'&response_type=code&scope=snsapi_userinfo&state=ST#wechart_redirect'

    }



</script>


</body>
</html>